<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Camilo Calderon">

<title>Econometrics and Analytics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-dfb324f25d9b1687192fa8be62ac8f9c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Econometrics and Analytics</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="./labs/part001.html">
 <span class="dropdown-text">Part 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./labs/part002.html">
 <span class="dropdown-text">Part 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./labs/part003.html">
 <span class="dropdown-text">Part 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./labs/part004.html">
 <span class="dropdown-text">Part 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./labs/part005.html">
 <span class="dropdown-text">Part 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./labs/part006.html">
 <span class="dropdown-text">Part 6</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./index.html">Econometrics and Analytics</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Econometrics and Analytics</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Labs</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./labs/part001.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fundamentals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./labs/part002.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab Part</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./labs/part003.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab Part</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./labs/part004.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab Part</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./labs/part005.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab Part</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./labs/part006.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab Part</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#welcome" id="toc-welcome" class="nav-link active" data-scroll-target="#welcome">Welcome</a></li>
  <li><a href="#app-and-website-disclaimer" id="toc-app-and-website-disclaimer" class="nav-link" data-scroll-target="#app-and-website-disclaimer">App and Website Disclaimer</a></li>
  <li><a href="#general-disclaimer" id="toc-general-disclaimer" class="nav-link" data-scroll-target="#general-disclaimer">General Disclaimer</a></li>
  <li><a href="#indicative-contents" id="toc-indicative-contents" class="nav-link" data-scroll-target="#indicative-contents">Indicative Contents</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Econometrics and Analytics</h1>
<p class="subtitle lead">A Lab Handbook in R</p>
</div>



<div class="quarto-title-meta column-body">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Camilo Calderon </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src=".\images/image1.png" class="img-fluid figure-img"></p>
<figcaption>I am Camilo Calderon, call me Cam!</figcaption>
</figure>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 32%">
<col style="width: 45%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>üë§ <strong>Author</strong></th>
<th>üìß <strong>Email</strong></th>
<th>üóìÔ∏è <strong>Version</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Dr Camilo Calderon</td>
<td>cam.calderon@dmu.ac.uk</td>
<td>03 July 2025</td>
</tr>
</tbody>
</table>
<blockquote class="blockquote">
<p><strong>Contact hours:</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Office:</strong></p>
</blockquote>
<section id="welcome" class="level1">
<h1>Welcome</h1>
<p>Welcome to <em>Econometrics and Analytics</em>! This textbook guides students through applied lab sessions using R, combining data science, econometrics, and visual learning.</p>
<p>üìò Navigate using the table of contents on the left.</p>
<p>üîç Each lab includes: - Practical exercises<br>
- R code<br>
- Embedded videos<br>
- Interactive charts (coming soon)</p>
<blockquote class="blockquote">
<p>‚ÄúThe best way to learn econometrics is to do it.‚Äù ‚Äì You, probably</p>
</blockquote>
<p>Econometrics introduces quantitative methods for both qualitative and quantitative data analysis. The focus includes a variety of estimation methods for economic data with diverse structures and uses applied applications of these econometric methods to estimate empirical models. These techniques provide a foundation for the final-year dissertation project.</p>
<p>Data Analytics provides an applied framework for economists to understand economic decision-making and the formation of expectations and forecasting. Analytics follows a topic-based approach to forecasting techniques and automatisation to areas of study such as Economics, Environmental Economics, Capital Markets, and Financial Economics. The content also covers an introduction to the Trading room, this will allow the techniques to be contextualised to applied problems.</p>
<p>This handbook has been produced to provide students with specific information and guidance about their labs. The contents of this handbook are indicative, this means they can be updated or modified upon the review of the module leader (Cam).</p>
<p>An electronic version of this handbook (which is continuously updated) is available on the VLE system, which you should consult regularly as the main reference point throughout your studies.</p>
<p>The handbook is organised in 50 minutes chunks, sometimes active lectures, othertimes practical labs.</p>
</section>
<section id="app-and-website-disclaimer" class="level1">
<h1>App and Website Disclaimer</h1>
<p>From time to time this website may include links to other third party websites. These links are used to provide further information and do not mean that DMU endorses those websites and/or their content. DMU takes no responsibility for any loss or damage suffered as a result of using any information published on any of the pages on the linked third party websites.</p>
<p>Teaching staff may recommend the use of a particular technology when they feel that it is necessary and beneficial to students‚Äô learning. Please note: Technology of this nature often includes the option to install an App and as with all technology there is a risk of malware. The university does not warrant the quality of any third party Apps or that there is no risk of malware. The university will where possible provide alternatives to installing an App either through direct internet access using the student‚Äôs operating systems internet browser or provide alternative methods to formative learning.</p>
<p>In opting to install any App or accessing any website using the student‚Äôs device, the university does not make or give, any representation, warranty or commitment as to:</p>
<blockquote class="blockquote">
<p><strong>its quality, viability and operation;</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>its description, its fitness for any particular or general use;</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>the absence of any latent or other defect, discoverable or otherwise.</strong></p>
</blockquote>
<p>The student agrees that the use and download of the App or access of the website is at his/her sole discretion and risk. In downloading of materials it is the student‚Äôs responsibility to ensure that material is virus checked by up to date virus software.</p>
<p>It is the student‚Äôs responsibility to back-up all data and will be solely responsible for any damage to her/his computer/mobile device or loss, alteration or corruption of data or files that results from the download of the App or access of the website.</p>
</section>
<section id="general-disclaimer" class="level1">
<h1>General Disclaimer</h1>
<p>The University expressly excludes liability for loss or damage arising from your use of this site or of any App (except in the case of death or personal injury arising from our negligence).</p>
</section>
<section id="indicative-contents" class="level1">
<h1>Indicative Contents</h1>
<p>Lab 1: üìÑ Introduction &amp; üìã Assignment Brief</p>
<p>Lab 2: Approaching Forecasting &amp; Data Collection</p>
<p>Lab 3: Videos about R (Linked with MCQs assessment)</p>
<p>Lab 4: A Quick Intro to R</p>
<p>Lab 5: R certification &amp; Package swirl</p>
<p>Lab 6: Uploading Excel Files to R</p>
<p>Lab 7: Data Visualisation</p>
<p>Lab 8: Mock/Practice test &amp; AI AND R</p>
<p>Lab 9: ‚Äì Intro to Refinitiv</p>
<p>Lab 10: Refinitiv: News, forecasts, Macrox</p>


</section>

</main> <!-- /main -->
<script>

  let textbookContent = "";



  const textFiles = [

    "labs/text001.txt",

    "labs/text002.txt",

    "labs/text003.txt",

    "labs/text004.txt",

    "labs/text005.txt",

    "labs/text006.txt"

  ];



  async function loadTextFiles() {

    const fetches = textFiles.map(file => fetch(file).then(r => r.text()));

    const contents = await Promise.all(fetches);

    textbookContent = contents.join("\n").slice(0, 3000);  // Limit context length if needed

  }



  document.addEventListener("DOMContentLoaded", async function () {

    await loadTextFiles();



    const sidebar = document.querySelector(".sidebar-navigation");

    if (!sidebar) return;



    const aiContainer = document.createElement("div");

    aiContainer.style.marginTop = "30px";

    aiContainer.style.padding = "10px";

    aiContainer.style.background = "#f8f9fa";

    aiContainer.style.borderTop = "1px solid #ccc";



    aiContainer.innerHTML = `

      <h4 style="margin-top:0;">ü§ñ Ask AI</h4>

      <textarea id="user-input" style="width:100%; height:60px; font-size:0.85em;" placeholder="Ask a question..."></textarea>

      <button onclick="sendToAssistant()" style="width:100%; margin-top:5px; font-size:0.85em;">Send</button>

      <div id="assistant-response" style="margin-top:10px; font-size:0.8em; max-height:150px; overflow:auto;"></div>

    `;



    sidebar.appendChild(aiContainer);

  });



  async function sendToAssistant() {

    const userInput = document.getElementById("user-input").value;

    if (!userInput) return;



    const responseBox = document.getElementById("assistant-response");

    responseBox.innerText = "Thinking...";



    try {

      const response = await fetch("https://key-openai-proxy.vercel.app/api/proxy", {

        method: "POST",

        headers: {

          "Content-Type": "application/json"

        },

        body: JSON.stringify({

          model: "gpt-3.5-turbo",

          messages: [

            {

              role: "system",

              content: `You are a helpful teaching assistant for a book titled "Econometrics and Analytics" by Camilo Calderon. Here is part of the textbook:\n\n${textbookContent}`

            },

            {

              role: "user",

              content: userInput

            }

          ],

          temperature: 0.7

        })

      });



      const data = await response.json();



      if (data.error) {

        console.error("OpenAI Error:", data.error);

        responseBox.innerText = `Error: ${data.error.message || "Unknown error from OpenAI"}`;

        return;

      }



      const reply = data.choices?.[0]?.message?.content || "No response received.";

      responseBox.innerText = reply;

    } catch (error) {

      console.error("Fetch error:", error);

      responseBox.innerText = "Error talking to AI: " + error.message;

    }

  }

</script>

<script>

  document.addEventListener("DOMContentLoaded", function () {

    const toc = document.querySelector("nav#TOC");

    if (toc) {

      const container = document.createElement("div");

      container.style.marginTop = "2em";

      container.style.borderTop = "1px solid #ddd";

      container.style.paddingTop = "1em";

      container.innerHTML = `

        <strong>üí° Anonymous Suggestion Box</strong><br>

        <a href="https://forms.office.com/e/9SShcF2B24" target="_blank">Submit ideas or feedback</a>

        <br><br>

        <img src="./images/suggestion.png" alt="Suggestion QR Code" width="120">

      `;

      toc.appendChild(container);

    }

  });

</script>

<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>