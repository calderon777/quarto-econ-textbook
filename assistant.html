<div id="chatbox" style="font-family: sans-serif; max-width: 600px; margin: auto;">
  <h3>Ask me anything from the textbook!</h3>
  <textarea id="userInput" rows="4" style="width: 100%;" placeholder="Type your question here..."></textarea>
  <br />
  <button onclick="askQuestion()" style="margin-top: 8px;">Ask</button>
  <pre id="response" style="background: #f4f4f4; padding: 1em; white-space: pre-wrap;"></pre>
</div>

<script>
  async function askQuestion() {
    const userInput = document.getElementById("userInput").value;
    const responseBox = document.getElementById("response");
    responseBox.textContent = "Thinking...";

    const textbookContent = `You are a helpful teaching assistant for a textbook on R, data science, and econometrics. Your answers should be beginner-friendly and based strictly on the material. Avoid hallucinating information.`

    try {
      const response = await fetch("/api/chat", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          messages: [
            { role: "system", content: textbookContent },
            { role: "user", content: userInput }
          ]
        })
      });

      const data = await response.json();

      if (data && data.choices && data.choices.length > 0) {
        responseBox.textContent = data.choices[0].message.content.trim();
      } else {
        responseBox.textContent = "No response from the assistant.";
      }

    } catch (error) {
      responseBox.textContent = "Error: " + error.message;
    }
  }
</script>

